## Pipeline for CHAMPS, done (so far) by Marco Mravic DeGrado lab
## Dependencies: Python 2.7, ProDy, NumPy, Rosetta locally downloaded & compiled

# Making base CAHMP dir and the working dir for CHAMP target of choice, e.g. a5 dir
> mkdir ~/CHAMP
> cd ~/CHAMP
> mkdir a5
> cd a5


######## Input file Prep #########

# get sequence for TM region of TM target flanked by a few residues, <= 40 residues
# > a-5 integrin EGSYGVPLWIIILAILFGLLLLGLLIYILYKLG
# uniprot TM region: GVPLWIIILAILFGLLLLGLLIYILY
# 


# Must also have a 40-residue single 'ideal' alpha helix PDB to thread this sequence on


## make a prelim pdb file of this target sequence, threading to ideal Alpha Helix

> python ~/CHAMP/bin/thread_repack.py EGSYGVPLWIIILAILFGLLLLGLLIYILYKLG ~/bin/40_allAlaIdealHelix.pdb ~/CHAMP/a5/thread/ ~/rosetta/

##

# Use this to orient in the membrane in a few steps below...

> mkdir ~/CHAMP/a5/RosMem_Target-input/


## get initial positioning in membrane of PDB file.
# 1) take a5/thread/threadedhelix_0001.pdb and submit to PPM server (http://opm.phar.umich.edu/server.php)
# 2) save output pdb file, e.g.  ~/CHAMP/a5/RosMem_Target-input/a5_OPMout
## 

# In spite of OPM prediction for PDB...
# INPUT this sequence for TM region prediction, I used OCTOPUS server (http://octopus.cbr.su.se/)
# Save output to text file, e.g. ~/CHAMP/a5/RosMem_Target-input/a5-Octopus.txt

## refine this positioning using Rosetta Membrane

> python ~/CHAMP/bin/orientHelix_rosMem.py ~/CHAMP/a5/RosMem_Target-input/a5_OPMout.pdb ~/CHAMP/a5/RosMem_Target-input/a5-Octopus.txt ~/rosetta/ ~/CHAMP/bin/helix_Relax.xml 

##

######## END Input file Prep #####



######## Finding Helical pairs in a geometric cluster 

> cd ~/CHAMP/a5/RosMem_Target-input/

> python ~/CHAMP/bin/templatePairsScreen.py ~/CHAMP/Cluster-004/ ~/CHAMP/a5/bbHits/ ~/CHAMP/a5/RosMem_Target-input/a5_OPMout_clean_0001.pdb ~/CHAMP/Cluster-004_ext/ EGSYGVPLWIIILAILFGLLLLGLLIYILYKLG 13 20 "[ASTG]\w\w[FMYWLIKR][ASG]\w\w[ILVFNQDEH]"
